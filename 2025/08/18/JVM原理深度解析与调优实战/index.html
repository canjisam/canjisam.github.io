<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>JVM原理深度解析与调优实战 | 诒森的博客</title><meta name="author" content="CanJisam"><meta name="copyright" content="CanJisam"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="深入解析JVM核心原理，包括内存模型、垃圾回收机制、类加载机制、对象创建与内存分配、并发编程支持等，结合调优实战案例"><meta property="og:type" content="article"><meta property="og:title" content="JVM原理深度解析与调优实战"><meta property="og:url" content="https://canjisam.github.io/2025/08/18/JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/index.html"><meta property="og:site_name" content="诒森的博客"><meta property="og:description" content="深入解析JVM核心原理，包括内存模型、垃圾回收机制、类加载机制、对象创建与内存分配、并发编程支持等，结合调优实战案例"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://canjisam.github.io/img/cover/eca45645431b46fea6db1634a45287b2_2.png"><meta property="article:published_time" content="2025-08-18T14:54:20.000Z"><meta property="article:modified_time" content="2025-08-19T15:38:04.642Z"><meta property="article:author" content="CanJisam"><meta property="article:tag" content="JVM"><meta property="article:tag" content="内存模型"><meta property="article:tag" content="垃圾回收"><meta property="article:tag" content="类加载机制"><meta property="article:tag" content="调优"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://canjisam.github.io/img/cover/eca45645431b46fea6db1634a45287b2_2.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "JVM原理深度解析与调优实战",
  "url": "https://canjisam.github.io/2025/08/18/JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/",
  "image": "https://canjisam.github.io/img/cover/eca45645431b46fea6db1634a45287b2_2.png",
  "datePublished": "2025-08-18T14:54:20.000Z",
  "dateModified": "2025-08-19T15:38:04.642Z",
  "author": [
    {
      "@type": "Person",
      "name": "CanJisam",
      "url": "https://canjisam.github.io/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://canjisam.github.io/2025/08/18/JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=5.3.5"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.2/css/all.min.css"><script>(()=>{const t={set:(e,t,o)=>{if(!o)return;const a=Date.now()+864e5*o;localStorage.setItem(e,JSON.stringify({value:t,expiry:a}))},get:e=>{const t=localStorage.getItem(e);if(!t)return;const{value:o,expiry:a}=JSON.parse(t);if(!(Date.now()>a))return o;localStorage.removeItem(e)}};window.btf={saveToLocal:t,getScript:(e,t={})=>new Promise((o,a)=>{const n=document.createElement("script");n.src=e,n.async=!0,Object.entries(t).forEach(([e,t])=>n.setAttribute(e,t)),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),getCSS:(e,t)=>new Promise((o,a)=>{const n=document.createElement("link");n.rel="stylesheet",n.href=e,t&&(n.id=t),n.onload=n.onreadystatechange=()=>{n.readyState&&!/loaded|complete/.test(n.readyState)||o()},n.onerror=a,document.head.appendChild(n)}),addGlobalFn:(e,t,o=!1,a=window)=>{if(e.startsWith("pjax"))return;const n=a.globalFn||{};n[e]=n[e]||{},n[e][o||Object.keys(n[e]).length]=t,a.globalFn=n}};const o=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#1a1a2e")},a=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};btf.activateDarkMode=o,btf.activateLightMode=a;const n=t.get("theme"),r=window.matchMedia("(prefers-color-scheme: dark)"),c=window.matchMedia("(prefers-color-scheme: light)");if(void 0===n){if(c.matches)a();else if(r.matches)o();else{const e=(new Date).getHours();e<=6||e>=18?o():a()}r.addEventListener("change",()=>{void 0===t.get("theme")&&(e.matches?o():a())})}else"light"===n?a():o();const d=t.get("aside-status");void 0!==d&&document.documentElement.classList.toggle("hide-aside","hide"===d);/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})()</script><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:1,unescape:!1,languages:{hits_empty:"未找到符合您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},highlight:{plugin:"prismjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:600,highlightFullpage:!0,highlightMacStyle:!0},copy:{success:"复制成功",error:"复制失败",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:void 0,lightbox:"null",Snackbar:void 0,infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyloadPlugin:!1,isAnchor:!1,percent:{toc:!0,rightside:!1},autoDarkmode:!0}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"JVM原理深度解析与调优实战",isHighlightShrink:!0,isToc:!0,pageType:"post"}</script><script>window.XF_API_KEY="33ec326f4348794e214e464ff2990f32",window.XF_API_SECRET="NDQ3NGYyZWMwZWQ0ZWQ4ZWUzMTMwY2Y4"</script><meta name="generator" content="Hexo 7.3.0"></head><body><script>window.paceOptions={restartOnPushState:!1},btf.addGlobalFn("pjaxSend",()=>{Pace.restart()},"pace_restart")</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">诒森的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">JVM原理深度解析与调优实战</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">JVM原理深度解析与调优实战</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-08-18T14:54:20.000Z" title="发表于 2025-08-18 22:54:20">2025-08-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-08-19T15:38:04.642Z" title="更新于 2025-08-19 23:38:04">2025-08-19</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/JVM%E5%8E%9F%E7%90%86/">JVM原理</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">5.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span class="min2read">24 分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/08/18/JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/#post-comment"><span class="valine-comment-count" data-xid="/2025/08/18/JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/"></span><span class="waline-comment-count" id="/2025/08/18/JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/"></span><span class="twikoo-count"></span><span class="fb-comments-count"></span><span class="gitalk-comment-count"></span></a></span></div></div></div><article class="container post-content" id="article-container"><h1 id="JVM原理深度解析与调优实战"><a href="#JVM原理深度解析与调优实战" class="headerlink" title="JVM原理深度解析与调优实战"></a>JVM原理深度解析与调优实战</h1><p>JVM（Java Virtual Machine）是Java程序的运行基石，深入理解JVM原理对于后端开发至关重要。本文将全面剖析JVM的核心机制，帮助读者掌握笔试面试重点，并提供实战调优经验。</p><h2 id="1-JVM内存模型深度解析"><a href="#1-JVM内存模型深度解析" class="headerlink" title="1. JVM内存模型深度解析"></a>1. JVM内存模型深度解析</h2><h3 id="1-1-内存区域划分"><a href="#1-1-内存区域划分" class="headerlink" title="1.1 内存区域划分"></a>1.1 内存区域划分</h3><p>JVM将内存划分为以下几个运行时数据区域：</p><pre class="line-numbers language-none"><code class="language-none">JVM内存结构
├── 线程共享区域
│   ├── 堆（Heap）
│   │   ├── 新生代（Young Generation）
│   │   │   ├── Eden区
│   │   │   ├── Survivor0区
│   │   │   └── Survivor1区
│   │   └── 老年代（Old Generation）
│   ├── 方法区（Method Area）
│   │   ├── 类信息
│   │   ├── 常量池
│   │   ├── 静态变量
│   │   └── JIT代码缓存
│   └── 运行时常量池（Runtime Constant Pool）
└── 线程私有区域
    ├── 程序计数器（Program Counter Register）
    ├── 虚拟机栈（JVM Stack）
    └── 本地方法栈（Native Method Stack）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-2-各区域详解与OOM分析"><a href="#1-2-各区域详解与OOM分析" class="headerlink" title="1.2 各区域详解与OOM分析"></a>1.2 各区域详解与OOM分析</h3><h4 id="1-2-1-堆（Heap）"><a href="#1-2-1-堆（Heap）" class="headerlink" title="1.2.1 堆（Heap）"></a>1.2.1 堆（Heap）</h4><p>堆是JVM管理的最大一块内存区域，用于存放对象实例：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 堆内存配置参数</span>
<span class="token operator">-</span><span class="token class-name">Xms512m</span>    # 初始堆大小
<span class="token operator">-</span><span class="token class-name">Xmx1024m</span>   # 最大堆大小
<span class="token operator">-</span><span class="token class-name">Xmn256m</span>    # 新生代大小
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">NewRatio</span><span class="token operator">=</span><span class="token number">2</span>    # 新生代与老年代比例
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">SurvivorRatio</span><span class="token operator">=</span><span class="token number">8</span>    # <span class="token class-name">Eden</span>与<span class="token class-name">Survivor</span>比例<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>堆OOM示例</strong>：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 堆内存溢出示例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HeapOOM</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OOMObject</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OOMObject</span><span class="token punctuation">></span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">OOMObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// JVM参数：-Xms20m -Xmx20m -XX:+HeapDumpOnOutOfMemoryError</span>
<span class="token comment">// 错误信息：java.lang.OutOfMemoryError: Java heap space</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-2-方法区（Method-Area）"><a href="#1-2-2-方法区（Method-Area）" class="headerlink" title="1.2.2 方法区（Method Area）"></a>1.2.2 方法区（Method Area）</h4><p>方法区用于存储已被虚拟机加载的类信息、常量、静态变量等：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 方法区OOM示例（JDK8前）</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodAreaOOM</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">MethodAreaOOM</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MethodAreaOOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span><span class="token class-name">OOMObject</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                enhancer<span class="token punctuation">.</span><span class="token function">setUseCache</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> 
                                          <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> proxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">&#123;</span>
                        <span class="token keyword">return</span> proxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">&#125;</span>
                <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                i<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"创建类数量："</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">OOMObject</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 错误信息：java.lang.OutOfMemoryError: Metaspace（JDK8+）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="1-2-3-虚拟机栈（JVM-Stack）"><a href="#1-2-3-虚拟机栈（JVM-Stack）" class="headerlink" title="1.2.3 虚拟机栈（JVM Stack）"></a>1.2.3 虚拟机栈（JVM Stack）</h4><p>每个方法执行时都会创建一个栈帧用于存储局部变量表、操作数栈等：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 栈溢出示例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StackOOM</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> stackLength <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        stackLength<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">StackOOM</span> oom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StackOOM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            oom<span class="token punctuation">.</span><span class="token function">stackLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"栈深度："</span> <span class="token operator">+</span> oom<span class="token punctuation">.</span>stackLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 错误信息：java.lang.StackOverflowError</span>
<span class="token comment">// JVM参数：-Xss128k 设置栈大小</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-对象分配与内存布局"><a href="#1-3-对象分配与内存布局" class="headerlink" title="1.3 对象分配与内存布局"></a>1.3 对象分配与内存布局</h3><h4 id="1-3-1-对象创建过程"><a href="#1-3-1-对象创建过程" class="headerlink" title="1.3.1 对象创建过程"></a>1.3.1 对象创建过程</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 对象创建步骤详解</span>
<span class="token class-name">Object</span> obj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ol><li><strong>类加载检查</strong>：检查类是否已加载、解析、初始化</li><li><strong>分配内存</strong>：<ul><li>指针碰撞（Bump the Pointer）：内存规整时使用</li><li>空闲列表（Free List）：内存碎片较多时使用</li></ul></li><li><strong>初始化零值</strong>：将分配到的内存空间初始化为零值</li><li><strong>设置对象头</strong>：包括哈希码、GC分代年龄、锁状态等</li><li><strong>执行init方法</strong>：按照程序员的意愿初始化对象</li></ol><h4 id="1-3-2-对象内存布局"><a href="#1-3-2-对象内存布局" class="headerlink" title="1.3.2 对象内存布局"></a>1.3.2 对象内存布局</h4><pre class="line-numbers language-none"><code class="language-none">对象内存布局
├── 对象头（Header）
│   ├── Mark Word（64位系统占8字节）
│   │   ├── 哈希码（25位）
│   │   ├── GC分代年龄（4位）
│   │   ├── 锁状态标志（2位）
│   │   ├── 是否偏向锁（1位）
│   │   └── 偏向线程ID（23位）
│   └── 类型指针（Class Pointer）
├── 实例数据（Instance Data）
└── 对齐填充（Padding）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-垃圾回收机制深度剖析"><a href="#2-垃圾回收机制深度剖析" class="headerlink" title="2. 垃圾回收机制深度剖析"></a>2. 垃圾回收机制深度剖析</h2><h3 id="2-1-垃圾回收基础理论"><a href="#2-1-垃圾回收基础理论" class="headerlink" title="2.1 垃圾回收基础理论"></a>2.1 垃圾回收基础理论</h3><h4 id="2-1-1-判断对象存活算法"><a href="#2-1-1-判断对象存活算法" class="headerlink" title="2.1.1 判断对象存活算法"></a>2.1.1 判断对象存活算法</h4><p><strong>引用计数法</strong>：</p><ul><li>原理：给对象添加引用计数器，引用时+1，失效时-1</li><li>缺点：无法解决循环引用问题</li></ul><p><strong>可达性分析算法</strong>：</p><ul><li>原理：从GC Roots开始向下搜索，不可达的对象可被回收</li><li>GC Roots包括：<ul><li>虚拟机栈中引用的对象</li><li>方法区中类静态属性引用的对象</li><li>方法区中常量引用的对象</li><li>本地方法栈中JNI引用的对象</li></ul></li></ul><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 循环引用示例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReferenceCountingGC</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> instance <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">ReferenceCountingGC</span> objA <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ReferenceCountingGC</span> objB <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReferenceCountingGC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        objA<span class="token punctuation">.</span>instance <span class="token operator">=</span> objB<span class="token punctuation">;</span>
        objB<span class="token punctuation">.</span>instance <span class="token operator">=</span> objA<span class="token punctuation">;</span>
        
        objA <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        objB <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 即使循环引用，也会被回收</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-1-2-垃圾回收算法"><a href="#2-1-2-垃圾回收算法" class="headerlink" title="2.1.2 垃圾回收算法"></a>2.1.2 垃圾回收算法</h4><p><strong>标记-清除算法（Mark-Sweep）</strong>：</p><ul><li>标记所有需要回收的对象，然后统一回收</li><li>缺点：效率低、产生内存碎片</li></ul><p><strong>复制算法（Copying）</strong>：</p><ul><li>将内存分为两块，每次使用一块，回收时复制存活对象到另一块</li><li>优点：实现简单、运行高效</li><li>缺点：内存利用率低</li></ul><p><strong>标记-整理算法（Mark-Compact）</strong>：</p><ul><li>标记存活对象，然后将所有存活对象向一端移动，清理边界外内存</li><li>适用于老年代</li></ul><p><strong>分代收集算法</strong>：</p><ul><li>新生代：复制算法</li><li>老年代：标记-清除或标记-整理算法</li></ul><h3 id="2-2-HotSpot垃圾回收器详解"><a href="#2-2-HotSpot垃圾回收器详解" class="headerlink" title="2.2 HotSpot垃圾回收器详解"></a>2.2 HotSpot垃圾回收器详解</h3><h4 id="2-2-1-垃圾回收器概览"><a href="#2-2-1-垃圾回收器概览" class="headerlink" title="2.2.1 垃圾回收器概览"></a>2.2.1 垃圾回收器概览</h4><pre class="line-numbers language-none"><code class="language-none">垃圾回收器分类
├── 新生代收集器
│   ├── Serial收集器（-XX:+UseSerialGC）
│   ├── ParNew收集器（-XX:+UseParNewGC）
│   └── Parallel Scavenge（-XX:+UseParallelGC）
├── 老年代收集器
│   ├── Serial Old收集器
│   ├── Parallel Old收集器（-XX:+UseParallelOldGC）
│   └── CMS收集器（-XX:+UseConcMarkSweepGC）
└── 整堆收集器
    ├── G1收集器（-XX:+UseG1GC）
    ├── ZGC（JDK11+）
    └── Shenandoah（JDK12+）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-2-2-CMS收集器详解"><a href="#2-2-2-CMS收集器详解" class="headerlink" title="2.2.2 CMS收集器详解"></a>2.2.2 CMS收集器详解</h4><p>CMS（Concurrent Mark Sweep）收集器是一种以获取最短回收停顿时间为目标的收集器：</p><pre class="line-numbers language-none"><code class="language-none">CMS收集器工作流程
├── 初始标记（Initial Mark）
│   └── 标记GC Roots能直接关联的对象，需要&quot;Stop The World&quot;
├── 并发标记（Concurrent Mark）
│   └── 进行GC Roots Tracing，与应用线程并发执行
├── 重新标记（Remark）
│   └── 修正并发标记期间变动的标记记录，需要&quot;Stop The World&quot;
└── 并发清除（Concurrent Sweep）
    └── 清除无用对象，与应用线程并发执行<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>CMS优缺点</strong>：</p><ul><li>优点：并发收集、低停顿</li><li>缺点：<ul><li>对CPU资源敏感</li><li>无法处理浮动垃圾</li><li>基于标记-清除算法，会产生内存碎片</li></ul></li></ul><h4 id="2-2-3-G1收集器详解"><a href="#2-2-3-G1收集器详解" class="headerlink" title="2.2.3 G1收集器详解"></a>2.2.3 G1收集器详解</h4><p>G1（Garbage First）收集器是一款面向服务端应用的垃圾收集器：</p><pre class="line-numbers language-none"><code class="language-none">G1收集器特点
├── 并行与并发
├── 分代收集
├── 空间整合（整体基于标记-整理，局部基于复制）
├── 可预测的停顿时间模型
└── 将整个Java堆划分为多个大小相等的独立区域（Region）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>G1收集器工作流程</strong>：</p><ol><li>初始标记（Initial Marking）</li><li>并发标记（Concurrent Marking）</li><li>最终标记（Final Marking）</li><li>筛选回收（Live Data Counting and Evacuation）</li></ol><h4 id="2-2-4-垃圾回收器对比"><a href="#2-2-4-垃圾回收器对比" class="headerlink" title="2.2.4 垃圾回收器对比"></a>2.2.4 垃圾回收器对比</h4><table><thead><tr><th>收集器</th><th>串行&#x2F;并行&#x2F;并发</th><th>算法</th><th>目标</th><th>适用场景</th></tr></thead><tbody><tr><td><strong>Serial</strong></td><td>串行</td><td>复制算法</td><td>响应速度优先</td><td>单CPU环境，Client模式</td></tr><tr><td><strong>ParNew</strong></td><td>并行</td><td>复制算法</td><td>响应速度优先</td><td>多CPU环境，配合CMS</td></tr><tr><td><strong>Parallel</strong></td><td>并行</td><td>复制算法</td><td>吞吐量优先</td><td>后台运算，不需要太多交互</td></tr><tr><td><strong>CMS</strong></td><td>并发</td><td>标记-清除</td><td>响应速度优先</td><td>互联网站或B&#x2F;S系统</td></tr><tr><td><strong>G1</strong></td><td>并发</td><td>标记-整理+复制</td><td>响应速度优先</td><td>面向服务端应用</td></tr></tbody></table><h3 id="2-3-Full-GC触发条件"><a href="#2-3-Full-GC触发条件" class="headerlink" title="2.3 Full GC触发条件"></a>2.3 Full GC触发条件</h3><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Full GC触发条件总结</span>
<span class="token number">1.</span> 老年代空间不足
<span class="token number">2.</span> 方法区空间不足（<span class="token constant">JDK8</span>前）
<span class="token number">3.</span> 调用<span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">gc</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token number">4.</span> <span class="token constant">CMS</span> <span class="token constant">GC</span>时出现promotion failed和concurrent mode failure
<span class="token number">5.</span> 统计得到的<span class="token class-name">Minor</span> <span class="token constant">GC</span>晋升到老年代的平均大小大于老年代的剩余空间<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-类加载机制深度解析"><a href="#3-类加载机制深度解析" class="headerlink" title="3. 类加载机制深度解析"></a>3. 类加载机制深度解析</h2><h3 id="3-1-类加载过程"><a href="#3-1-类加载过程" class="headerlink" title="3.1 类加载过程"></a>3.1 类加载过程</h3><pre class="line-numbers language-none"><code class="language-none">类加载生命周期
├── 加载（Loading）
├── 验证（Verification）
├── 准备（Preparation）
├── 解析（Resolution）
├── 初始化（Initialization）
├── 使用（Using）
└── 卸载（Unloading）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-1-1-加载阶段"><a href="#3-1-1-加载阶段" class="headerlink" title="3.1.1 加载阶段"></a>3.1.1 加载阶段</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 类加载器获取二进制字节流</span>
<span class="token comment">// 1. 从本地文件系统加载</span>
<span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"com.example.MyClass"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 从网络加载</span>
<span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">"http://example.com/classes/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">URLClassLoader</span> loader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLClassLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> clazz <span class="token operator">=</span> loader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"com.example.NetworkClass"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 动态生成</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classBytes <span class="token operator">=</span> <span class="token function">generateClassBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> dynamicClass <span class="token operator">=</span> <span class="token function">defineClass</span><span class="token punctuation">(</span><span class="token string">"DynamicClass"</span><span class="token punctuation">,</span> classBytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classBytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-1-2-验证阶段"><a href="#3-1-2-验证阶段" class="headerlink" title="3.1.2 验证阶段"></a>3.1.2 验证阶段</h4><ul><li>文件格式验证：验证字节流是否符合Class文件格式规范</li><li>元数据验证：对字节码描述的信息进行语义分析</li><li>字节码验证：通过数据流和控制流分析，确保程序语义是合法的</li><li>符号引用验证：确保解析动作能正常执行</li></ul><h4 id="3-1-3-准备阶段"><a href="#3-1-3-准备阶段" class="headerlink" title="3.1.3 准备阶段"></a>3.1.3 准备阶段</h4><p>为类变量分配内存并设置类变量初始值：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreparationTest</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 准备阶段后，value值为0，不是123</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 准备阶段后，value值为null</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">"hello"</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-1-4-解析阶段"><a href="#3-1-4-解析阶段" class="headerlink" title="3.1.4 解析阶段"></a>3.1.4 解析阶段</h4><p>将常量池内的符号引用替换为直接引用：</p><ul><li>类或接口的解析</li><li>字段解析</li><li>类方法解析</li><li>接口方法解析</li></ul><h4 id="3-1-5-初始化阶段"><a href="#3-1-5-初始化阶段" class="headerlink" title="3.1.5 初始化阶段"></a>3.1.5 初始化阶段</h4><p>执行类构造器<code>&lt;clinit&gt;()</code>方法：</p><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InitializationTest</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"InitializationTest类初始化"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">int</span> value <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">InitializationTest</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-2-双亲委派模型"><a href="#3-2-双亲委派模型" class="headerlink" title="3.2 双亲委派模型"></a>3.2 双亲委派模型</h3><pre class="line-numbers language-none"><code class="language-none">类加载器层次结构
├── 启动类加载器（Bootstrap ClassLoader）
│   └── 加载&lt;JAVA_HOME&gt;&#x2F;lib目录下的类
├── 扩展类加载器（Extension ClassLoader）
│   └── 加载&lt;JAVA_HOME&gt;&#x2F;lib&#x2F;ext目录下的类
├── 应用程序类加载器（Application ClassLoader）
│   └── 加载用户类路径（ClassPath）上的类
└── 自定义类加载器（User Defined ClassLoader）
    └── 用户自定义的类加载器<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-2-1-双亲委派模型实现"><a href="#3-2-1-双亲委派模型实现" class="headerlink" title="3.2.1 双亲委派模型实现"></a>3.2.1 双亲委派模型实现</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 双亲委派模型的loadClass方法实现</span>
<span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">,</span> <span class="token keyword">boolean</span> resolve<span class="token punctuation">)</span> 
    <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token function">getClassLoadingLock</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 首先，检查类是否已经被加载</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> c <span class="token operator">=</span> <span class="token function">findLoadedClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">long</span> t0 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// 委派给父类加载器加载</span>
                    c <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// 委派给启动类加载器加载</span>
                    c <span class="token operator">=</span> <span class="token function">findBootstrapClassOrNull</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 父类加载器无法完成加载请求</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 父类加载器无法加载，调用自身的findClass方法加载</span>
                <span class="token keyword">long</span> t1 <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">nanoTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                c <span class="token operator">=</span> <span class="token function">findClass</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
                
                <span class="token comment">// 记录统计信息</span>
                <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>PerfCounter</span><span class="token punctuation">.</span><span class="token function">getParentDelegationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addTime</span><span class="token punctuation">(</span>t1 <span class="token operator">-</span> t0<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>PerfCounter</span><span class="token punctuation">.</span><span class="token function">getFindClassTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addElapsedTimeFrom</span><span class="token punctuation">(</span>t1<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>PerfCounter</span><span class="token punctuation">.</span><span class="token function">getFindClasses</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>resolve<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token function">resolveClass</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        <span class="token keyword">return</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-2-2-破坏双亲委派模型"><a href="#3-2-2-破坏双亲委派模型" class="headerlink" title="3.2.2 破坏双亲委派模型"></a>3.2.2 破坏双亲委派模型</h4><p><strong>第一次破坏</strong>：JDK1.2引入双亲委派模型前，用户自定义类加载器已有loadClass方法</p><p><strong>第二次破坏</strong>：JNDI、JDBC等服务提供者接口（SPI）需要调用启动类加载器无法加载的代码</p><p><strong>第三次破坏</strong>：OSGi为了实现模块化热部署，每个模块都有自己的类加载器</p><h3 id="3-3-类加载优化策略"><a href="#3-3-类加载优化策略" class="headerlink" title="3.3 类加载优化策略"></a>3.3 类加载优化策略</h3><h4 id="3-3-1-预加载策略"><a href="#3-3-1-预加载策略" class="headerlink" title="3.3.1 预加载策略"></a>3.3.1 预加载策略</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 预加载常用类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PreloadClasses</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.util.concurrent.ConcurrentHashMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.util.ArrayList"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"java.util.HashMap"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-3-2-懒加载策略"><a href="#3-3-2-懒加载策略" class="headerlink" title="3.3.2 懒加载策略"></a>3.3.2 懒加载策略</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 单例模式的懒加载实现</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LazySingleton</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Holder</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">LazySingleton</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LazySingleton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">LazySingleton</span> <span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">return</span> <span class="token class-name">Holder</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-3-3-热部署实现"><a href="#3-3-3-热部署实现" class="headerlink" title="3.3.3 热部署实现"></a>3.3.3 热部署实现</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 自定义类加载器实现热部署</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HotDeployClassLoader</span> <span class="token keyword">extends</span> <span class="token class-name">URLClassLoader</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token class-name">HotDeployClassLoader</span><span class="token punctuation">(</span><span class="token constant">URL</span><span class="token punctuation">[</span><span class="token punctuation">]</span> urls<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>urls<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classBytes <span class="token operator">=</span> <span class="token function">loadClassBytes</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> classBytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classBytes<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ClassNotFoundException</span><span class="token punctuation">(</span><span class="token string">"Class "</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">" not found"</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">private</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">loadClassBytes</span><span class="token punctuation">(</span><span class="token class-name">String</span> className<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">String</span> classFile <span class="token operator">=</span> className<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">,</span> <span class="token char">'/'</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">".class"</span><span class="token punctuation">;</span>
        <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token function">findResource</span><span class="token punctuation">(</span>classFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>url <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Class file not found: "</span> <span class="token operator">+</span> classFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token keyword">try</span> <span class="token punctuation">(</span><span class="token class-name">InputStream</span> in <span class="token operator">=</span> url<span class="token punctuation">.</span><span class="token function">openStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">ByteArrayOutputStream</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">int</span> data <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>data <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                buffer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                data <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token keyword">return</span> buffer<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="4-对象创建与内存分配策略"><a href="#4-对象创建与内存分配策略" class="headerlink" title="4. 对象创建与内存分配策略"></a>4. 对象创建与内存分配策略</h2><h3 id="4-1-对象创建详细过程"><a href="#4-1-对象创建详细过程" class="headerlink" title="4.1 对象创建详细过程"></a>4.1 对象创建详细过程</h3><h4 id="4-1-1-检查加载"><a href="#4-1-1-检查加载" class="headerlink" title="4.1.1 检查加载"></a>4.1.1 检查加载</h4><p>首先检查这个指令的参数是否能在常量池中定位到一个类的符号引用，并检查这个符号引用代表的类是否已被加载、解析和初始化过。</p><h4 id="4-1-2-分配内存"><a href="#4-1-2-分配内存" class="headerlink" title="4.1.2 分配内存"></a>4.1.2 分配内存</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 内存分配方式对比</span>

<span class="token comment">// 1. 指针碰撞（Bump the Pointer）</span>
<span class="token comment">// 适用场景：Serial、ParNew等带Compact过程的收集器</span>
<span class="token comment">// 原理：假设Java堆中内存是绝对规整的，所有用过的内存都放在一边，空闲的内存放在另一边，中间放着一个指针作为分界点的指示器</span>

<span class="token comment">// 2. 空闲列表（Free List）</span>
<span class="token comment">// 适用场景：CMS这种基于Mark-Sweep算法的收集器</span>
<span class="token comment">// 原理：虚拟机维护一个列表，记录哪些内存块是可用的，分配时从列表中找到一块足够大的空间划分给对象实例</span>

<span class="token comment">// 内存分配并发问题解决</span>
<span class="token comment">// 方案1：CAS + 失败重试</span>
<span class="token comment">// 方案2：本地线程分配缓冲（TLAB）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-1-3-内存分配实战"><a href="#4-1-3-内存分配实战" class="headerlink" title="4.1.3 内存分配实战"></a>4.1.3 内存分配实战</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// JVM参数设置示例</span>
<span class="token operator">-</span><span class="token class-name">Xms20m</span> <span class="token operator">-</span><span class="token class-name">Xmx20m</span> <span class="token operator">-</span><span class="token class-name">Xmn10m</span> <span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGCDetails</span> <span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">SurvivorRatio</span><span class="token operator">=</span><span class="token number">8</span>

<span class="token comment">// 对象分配示例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ObjectAllocationTest</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allocation1<span class="token punctuation">,</span> allocation2<span class="token punctuation">,</span> allocation3<span class="token punctuation">,</span> allocation4<span class="token punctuation">;</span>
        
        allocation1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>
        allocation2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>
        allocation3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>
        allocation4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 出现一次Minor GC</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// GC日志分析</span>
<span class="token punctuation">[</span><span class="token constant">GC</span> <span class="token punctuation">[</span><span class="token class-name">DefNew</span><span class="token operator">:</span> <span class="token number">6487</span>K<span class="token operator">-></span><span class="token function">148K</span><span class="token punctuation">(</span><span class="token number">9216</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0038720</span> secs<span class="token punctuation">]</span> <span class="token number">6487</span>K<span class="token operator">-></span><span class="token function">6292K</span><span class="token punctuation">(</span><span class="token number">19456</span>K<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.0039180</span> secs<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token class-name">Times</span><span class="token operator">:</span> user<span class="token operator">=</span><span class="token number">0.00</span> sys<span class="token operator">=</span><span class="token number">0.00</span><span class="token punctuation">,</span> real<span class="token operator">=</span><span class="token number">0.00</span> secs<span class="token punctuation">]</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="4-2-内存分配策略"><a href="#4-2-内存分配策略" class="headerlink" title="4.2 内存分配策略"></a>4.2 内存分配策略</h3><h4 id="4-2-1-对象优先在Eden分配"><a href="#4-2-1-对象优先在Eden分配" class="headerlink" title="4.2.1 对象优先在Eden分配"></a>4.2.1 对象优先在Eden分配</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Eden区分配示例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EdenAllocation</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">testAllocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allocation1<span class="token punctuation">,</span> allocation2<span class="token punctuation">,</span> allocation3<span class="token punctuation">,</span> allocation4<span class="token punctuation">;</span>
        allocation1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>
        allocation2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>
        allocation3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">2</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>
        allocation4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// Minor GC</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">testAllocation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-2-2-大对象直接进入老年代"><a href="#4-2-2-大对象直接进入老年代" class="headerlink" title="4.2.2 大对象直接进入老年代"></a>4.2.2 大对象直接进入老年代</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 大对象直接分配到老年代</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BigObjectToOld</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 大对象直接分配到老年代</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bigObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">8</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// JVM参数：-Xms20m -Xmx20m -Xmn10m -XX:+PrintGCDetails -XX:PretenureSizeThreshold=3145728</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-2-3-长期存活的对象进入老年代"><a href="#4-2-3-长期存活的对象进入老年代" class="headerlink" title="4.2.3 长期存活的对象进入老年代"></a>4.2.3 长期存活的对象进入老年代</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 长期存活对象晋升到老年代</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LongLifeToOld</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> _1MB <span class="token operator">=</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allocation1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span>_1MB <span class="token operator">/</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> allocation2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>
        allocation2 <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        allocation2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">4</span> <span class="token operator">*</span> _1MB<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">// JVM参数：-Xms20m -Xmx20m -Xmn10m -XX:+PrintGCDetails -XX:MaxTenuringThreshold=1 -XX:+PrintTenuringDistribution</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="5-JVM并发编程支持机制"><a href="#5-JVM并发编程支持机制" class="headerlink" title="5. JVM并发编程支持机制"></a>5. JVM并发编程支持机制</h2><h3 id="5-1-synchronized锁升级过程"><a href="#5-1-synchronized锁升级过程" class="headerlink" title="5.1 synchronized锁升级过程"></a>5.1 synchronized锁升级过程</h3><h4 id="5-1-1-锁状态演化"><a href="#5-1-1-锁状态演化" class="headerlink" title="5.1.1 锁状态演化"></a>5.1.1 锁状态演化</h4><pre class="line-numbers language-none"><code class="language-none">synchronized锁升级过程
├── 无锁状态
├── 偏向锁（Biased Locking）
│   ├── 偏向第一个获取锁的线程
│   └── 通过CAS记录线程ID
├── 轻量级锁（Lightweight Locking）
│   ├── 线程竞争不激烈时使用
│   └── 通过CAS操作获取锁
└── 重量级锁（Heavyweight Locking）
    ├── 线程竞争激烈时使用
    └── 依赖操作系统Mutex Lock<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-1-2-锁升级实战"><a href="#5-1-2-锁升级实战" class="headerlink" title="5.1.2 锁升级实战"></a>5.1.2 锁升级实战</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 锁升级演示</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LockEscalationDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">Object</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 偏向锁</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"偏向锁状态"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
        
        <span class="token comment">// 轻量级锁</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"轻量级锁状态"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-></span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>lock<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"重量级锁状态"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">ClassLayout</span><span class="token punctuation">.</span><span class="token function">parseInstance</span><span class="token punctuation">(</span>lock<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toPrintable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-2-volatile关键字原理"><a href="#5-2-volatile关键字原理" class="headerlink" title="5.2 volatile关键字原理"></a>5.2 volatile关键字原理</h3><h4 id="5-2-1-内存语义"><a href="#5-2-1-内存语义" class="headerlink" title="5.2.1 内存语义"></a>5.2.1 内存语义</h4><ul><li><strong>可见性</strong>：写volatile变量时，JMM会把该线程对应的本地内存中的共享变量值立即刷新到主内存</li><li><strong>有序性</strong>：读volatile变量时，JMM会把该线程对应的本地内存置为无效，从主内存中读取共享变量</li></ul><h4 id="5-2-2-volatile实现原理"><a href="#5-2-2-volatile实现原理" class="headerlink" title="5.2.2 volatile实现原理"></a>5.2.2 volatile实现原理</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// volatile示例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VolatileExample</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">writer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// 写volatile变量</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">reader</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>   <span class="token comment">// 读volatile变量</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"flag is true"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 汇编代码分析</span>
<span class="token comment">// 写volatile变量：lock addl $0x0,(%rsp)</span>
<span class="token comment">// 读volatile变量：mov    0x10(%rsi),%eax</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-3-Monitor原理"><a href="#5-3-Monitor原理" class="headerlink" title="5.3 Monitor原理"></a>5.3 Monitor原理</h3><h4 id="5-3-1-Monitor结构"><a href="#5-3-1-Monitor结构" class="headerlink" title="5.3.1 Monitor结构"></a>5.3.1 Monitor结构</h4><pre class="line-numbers language-none"><code class="language-none">Monitor结构
├── Owner
├── EntryList
├── WaitSet
└── Count<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-3-2-Monitor实现"><a href="#5-3-2-Monitor实现" class="headerlink" title="5.3.2 Monitor实现"></a>5.3.2 Monitor实现</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// Monitor实现原理</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MonitorDemo</span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Object</span> monitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">synchronizedMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>monitor<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 临界区代码</span>
            <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
                monitor<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 进入WaitSet</span>
                monitor<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 唤醒EntryList中的线程</span>
            <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="6-JVM调优实战"><a href="#6-JVM调优实战" class="headerlink" title="6. JVM调优实战"></a>6. JVM调优实战</h2><h3 id="6-1-调优工具"><a href="#6-1-调优工具" class="headerlink" title="6.1 调优工具"></a>6.1 调优工具</h3><h4 id="6-1-1-命令行工具"><a href="#6-1-1-命令行工具" class="headerlink" title="6.1.1 命令行工具"></a>6.1.1 命令行工具</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># jps：查看Java进程</span>
jps <span class="token parameter variable">-lvm</span>

<span class="token comment"># jstat：监控JVM统计信息</span>
jstat <span class="token parameter variable">-gc</span> <span class="token number">12345</span> <span class="token number">1000</span> <span class="token number">5</span>  <span class="token comment"># 每1000ms输出一次GC信息，共5次</span>

<span class="token comment"># jinfo：查看和修改JVM参数</span>
jinfo <span class="token parameter variable">-flags</span> <span class="token number">12345</span>

<span class="token comment"># jmap：内存分析工具</span>
jmap <span class="token parameter variable">-histo</span> <span class="token number">12345</span>  <span class="token comment"># 查看堆内存直方图</span>
jmap <span class="token parameter variable">-dump:format</span><span class="token operator">=</span>b,file<span class="token operator">=</span>heap.hprof <span class="token number">12345</span>  <span class="token comment"># 生成堆转储文件</span>

<span class="token comment"># jstack：线程堆栈分析</span>
jstack <span class="token number">12345</span> <span class="token operator">></span> thread_dump.txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-1-2-可视化工具"><a href="#6-1-2-可视化工具" class="headerlink" title="6.1.2 可视化工具"></a>6.1.2 可视化工具</h4><ul><li><strong>JConsole</strong>：JVM监控与管理控制台</li><li><strong>VisualVM</strong>：功能更强大的可视化工具</li><li><strong>MAT</strong>：内存分析工具</li><li><strong>GCEasy</strong>：在线GC日志分析工具</li></ul><h3 id="6-2-调优案例分析"><a href="#6-2-调优案例分析" class="headerlink" title="6.2 调优案例分析"></a>6.2 调优案例分析</h3><h4 id="6-2-1-高并发场景调优"><a href="#6-2-1-高并发场景调优" class="headerlink" title="6.2.1 高并发场景调优"></a>6.2.1 高并发场景调优</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 高并发Web应用调优案例</span>
<span class="token comment">// 应用特点：高并发、短生命周期对象多</span>

<span class="token comment">// JVM参数配置</span>
<span class="token operator">-</span><span class="token class-name">Xms4g</span> <span class="token operator">-</span><span class="token class-name">Xmx4g</span> <span class="token operator">-</span><span class="token class-name">Xmn2g</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseG1GC</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">MaxGCPauseMillis</span><span class="token operator">=</span><span class="token number">200</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token class-name">G1HeapRegionSize</span><span class="token operator">=</span><span class="token number">16</span>m
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UnlockExperimentalVMOptions</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">UseCGroupMemoryLimitForHeap</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGCDetails</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGCTimeStamps</span>
<span class="token operator">-</span><span class="token constant">XX</span><span class="token operator">:</span><span class="token operator">+</span><span class="token class-name">PrintGCApplicationStoppedTime</span>
<span class="token operator">-</span><span class="token class-name">Xloggc</span><span class="token operator">:</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>app<span class="token operator">/</span>gc<span class="token punctuation">.</span>log

<span class="token comment">// 代码优化</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HighConcurrencyService</span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// 使用对象池减少GC压力</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">ObjectPool</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RequestContext</span><span class="token punctuation">></span></span> contextPool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GenericObjectPool</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>
        <span class="token keyword">new</span> <span class="token class-name">BasePooledObjectFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RequestContext</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">RequestContext</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RequestContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
            
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">PooledObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RequestContext</span><span class="token punctuation">></span></span> <span class="token function">wrap</span><span class="token punctuation">(</span><span class="token class-name">RequestContext</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPooledObject</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">RequestContext</span> context <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span>
            context <span class="token operator">=</span> contextPool<span class="token punctuation">.</span><span class="token function">borrowObject</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 处理请求</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 异常处理</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">finally</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>context <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                context<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                contextPool<span class="token punctuation">.</span><span class="token function">returnObject</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-2-2-内存泄漏排查"><a href="#6-2-2-内存泄漏排查" class="headerlink" title="6.2.2 内存泄漏排查"></a>6.2.2 内存泄漏排查</h4><pre class="line-numbers language-java" data-language="java"><code class="language-java"><span class="token comment">// 内存泄漏排查案例</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MemoryLeakDetector</span> <span class="token punctuation">&#123;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 1. 生成堆转储文件</span>
        <span class="token class-name">String</span> pid <span class="token operator">=</span> <span class="token class-name">ManagementFactory</span><span class="token punctuation">.</span><span class="token function">getRuntimeMXBean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"@"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 2. 使用jmap生成堆转储</span>
        <span class="token class-name">Process</span> process <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>
            <span class="token string">"jmap -dump:format=b,file=heap.hprof "</span> <span class="token operator">+</span> pid
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        process<span class="token punctuation">.</span><span class="token function">waitFor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 3. 使用MAT分析</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"堆转储文件已生成：heap.hprof"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"使用MAT打开文件，查找内存泄漏"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// 常见内存泄漏场景</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CommonMemoryLeaks</span> <span class="token punctuation">&#123;</span>
    
    <span class="token comment">// 1. 静态集合类导致的内存泄漏</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">></span></span> staticList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addToStaticList</span><span class="token punctuation">(</span><span class="token class-name">Object</span> obj<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        staticList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 对象无法被GC</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 2. 未关闭的资源</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">resourceLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span>
        <span class="token class-name">FileInputStream</span> fis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span><span class="token string">"file.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 忘记关闭流，导致内存泄漏</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 3. 内部类持有外部类引用</span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InnerClass</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 非静态内部类会隐式持有外部类引用</span>
    <span class="token punctuation">&#125;</span>
    
    <span class="token comment">// 4. ThreadLocal使用不当</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span><span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">></span> threadLocal <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">threadLocalLeak</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        threadLocal<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 使用后未remove</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="6-3-性能调优参数总结"><a href="#6-3-性能调优参数总结" class="headerlink" title="6.3 性能调优参数总结"></a>6.3 性能调优参数总结</h3><h4 id="6-3-1-堆内存参数"><a href="#6-3-1-堆内存参数" class="headerlink" title="6.3.1 堆内存参数"></a>6.3.1 堆内存参数</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 基础参数</span>
-Xms<span class="token operator">&lt;</span>size<span class="token operator">></span>        <span class="token comment"># 初始堆大小</span>
-Xmx<span class="token operator">&lt;</span>size<span class="token operator">></span>        <span class="token comment"># 最大堆大小</span>
-Xmn<span class="token operator">&lt;</span>size<span class="token operator">></span>        <span class="token comment"># 新生代大小</span>
<span class="token parameter variable">-XX:NewRatio</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>  <span class="token comment"># 新生代与老年代比例</span>
<span class="token parameter variable">-XX:SurvivorRatio</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>  <span class="token comment"># Eden与Survivor比例</span>

<span class="token comment"># 进阶参数</span>
<span class="token parameter variable">-XX:PretenureSizeThreshold</span><span class="token operator">=</span><span class="token operator">&lt;</span>size<span class="token operator">></span>  <span class="token comment"># 大对象直接进入老年代阈值</span>
<span class="token parameter variable">-XX:MaxTenuringThreshold</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>       <span class="token comment"># 晋升老年代年龄阈值</span>
<span class="token parameter variable">-XX:+UseTLAB</span>                       <span class="token comment"># 使用TLAB</span>
<span class="token parameter variable">-XX:TLABSize</span><span class="token operator">=</span><span class="token operator">&lt;</span>size<span class="token operator">></span>               <span class="token comment"># TLAB大小</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-3-2-GC参数"><a href="#6-3-2-GC参数" class="headerlink" title="6.3.2 GC参数"></a>6.3.2 GC参数</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># Serial收集器</span>
<span class="token parameter variable">-XX:+UseSerialGC</span>

<span class="token comment"># ParNew收集器</span>
<span class="token parameter variable">-XX:+UseParNewGC</span>
<span class="token parameter variable">-XX:ParNewGCThreads</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>

<span class="token comment"># Parallel收集器</span>
<span class="token parameter variable">-XX:+UseParallelGC</span>
<span class="token parameter variable">-XX:+UseParallelOldGC</span>
<span class="token parameter variable">-XX:ParallelGCThreads</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>
<span class="token parameter variable">-XX:MaxGCPauseMillis</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>
<span class="token parameter variable">-XX:GCTimeRatio</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>

<span class="token comment"># CMS收集器</span>
<span class="token parameter variable">-XX:+UseConcMarkSweepGC</span>
<span class="token parameter variable">-XX:CMSInitiatingOccupancyFraction</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>
<span class="token parameter variable">-XX:+UseCMSCompactAtFullCollection</span>
<span class="token parameter variable">-XX:CMSFullGCsBeforeCompaction</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>

<span class="token comment"># G1收集器</span>
<span class="token parameter variable">-XX:+UseG1GC</span>
<span class="token parameter variable">-XX:MaxGCPauseMillis</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>
<span class="token parameter variable">-XX:G1HeapRegionSize</span><span class="token operator">=</span><span class="token operator">&lt;</span>size<span class="token operator">></span>
<span class="token parameter variable">-XX:G1NewSizePercent</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span>
<span class="token parameter variable">-XX:G1MaxNewSizePercent</span><span class="token operator">=</span><span class="token operator">&lt;</span>n<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-3-3-监控参数"><a href="#6-3-3-监控参数" class="headerlink" title="6.3.3 监控参数"></a>6.3.3 监控参数</h4><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># GC日志</span>
<span class="token parameter variable">-XX:+PrintGC</span>
<span class="token parameter variable">-XX:+PrintGCDetails</span>
<span class="token parameter variable">-XX:+PrintGCTimeStamps</span>
<span class="token parameter variable">-XX:+PrintGCApplicationStoppedTime</span>
-Xloggc:<span class="token operator">&lt;</span>filename<span class="token operator">></span>

<span class="token comment"># 堆转储</span>
<span class="token parameter variable">-XX:+HeapDumpOnOutOfMemoryError</span>
<span class="token parameter variable">-XX:HeapDumpPath</span><span class="token operator">=</span><span class="token operator">&lt;</span>path<span class="token operator">></span>
<span class="token parameter variable">-XX:+UseGCOverheadLimit</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="7-高频面试题总结"><a href="#7-高频面试题总结" class="headerlink" title="7. 高频面试题总结"></a>7. 高频面试题总结</h2><h3 id="7-1-JVM内存模型相关"><a href="#7-1-JVM内存模型相关" class="headerlink" title="7.1 JVM内存模型相关"></a>7.1 JVM内存模型相关</h3><ol><li><p><strong>JVM内存区域如何划分？各区域作用是什么？</strong></p><ul><li>方法区：存储类信息、常量、静态变量</li><li>堆：存放对象实例</li><li>虚拟机栈：方法调用、局部变量</li><li>本地方法栈：Native方法调用</li><li>程序计数器：当前线程执行的字节码行号指示器</li></ul></li><li><p><strong>堆内存为什么要分代？</strong></p><ul><li>基于弱代假说：绝大多数对象都是朝生夕灭的</li><li>提高垃圾回收效率</li><li>针对不同代采用不同的垃圾回收算法</li></ul></li><li><p><strong>方法区和元空间有什么区别？</strong></p><ul><li>JDK8前：方法区在永久代（PermGen）</li><li>JDK8后：方法区在元空间（Metaspace），使用本地内存</li><li>元空间可以动态扩容，避免OOM</li></ul></li></ol><h3 id="7-2-垃圾回收相关"><a href="#7-2-垃圾回收相关" class="headerlink" title="7.2 垃圾回收相关"></a>7.2 垃圾回收相关</h3><ol><li><p><strong>如何判断对象是否存活？</strong></p><ul><li>引用计数法：无法解决循环引用</li><li>可达性分析：从GC Roots开始，不可达的对象可被回收</li></ul></li><li><p><strong>垃圾回收算法有哪些？</strong></p><ul><li>标记-清除：简单但产生碎片</li><li>复制算法：高效但内存利用率低</li><li>标记-整理：避免碎片，适合老年代</li><li>分代收集：新生代复制，老年代标记-整理</li></ul></li><li><p><strong>CMS和G1收集器的区别？</strong></p><ul><li>CMS：标记-清除，老年代收集器，并发收集</li><li>G1：标记-整理+复制，整堆收集器，可预测停顿时间</li></ul></li><li><p><strong>Full GC触发条件有哪些？</strong></p><ul><li>老年代空间不足</li><li>方法区空间不足</li><li>System.gc()调用</li><li>CMS GC时出现promotion failed和concurrent mode failure</li></ul></li></ol><h3 id="7-3-类加载机制相关"><a href="#7-3-类加载机制相关" class="headerlink" title="7.3 类加载机制相关"></a>7.3 类加载机制相关</h3><ol><li><p><strong>类加载过程是怎样的？</strong></p><ul><li>加载、验证、准备、解析、初始化、使用、卸载</li></ul></li><li><p><strong>什么是双亲委派模型？</strong></p><ul><li>类加载请求先委派给父类加载器</li><li>避免类的重复加载</li><li>保证Java核心库的安全性</li></ul></li><li><p><strong>如何打破双亲委派模型？</strong></p><ul><li>SPI机制（JDBC、JNDI）</li><li>OSGi模块化</li><li>自定义类加载器</li></ul></li></ol><h3 id="7-4-并发编程相关"><a href="#7-4-并发编程相关" class="headerlink" title="7.4 并发编程相关"></a>7.4 并发编程相关</h3><ol><li><p><strong>synchronized锁升级过程？</strong></p><ul><li>无锁 → 偏向锁 → 轻量级锁 → 重量级锁</li></ul></li><li><p><strong>volatile关键字的作用？</strong></p><ul><li>保证可见性</li><li>禁止指令重排序</li></ul></li><li><p><strong>Monitor的实现原理？</strong></p><ul><li>基于ObjectMonitor实现</li><li>包含Owner、EntryList、WaitSet</li></ul></li></ol><h2 id="8-总结与最佳实践"><a href="#8-总结与最佳实践" class="headerlink" title="8. 总结与最佳实践"></a>8. 总结与最佳实践</h2><h3 id="8-1-JVM调优黄金法则"><a href="#8-1-JVM调优黄金法则" class="headerlink" title="8.1 JVM调优黄金法则"></a>8.1 JVM调优黄金法则</h3><ol><li><strong>先监控再调优</strong>：使用JConsole、VisualVM等工具收集数据</li><li><strong>小步快跑</strong>：每次只调整一个参数，观察效果</li><li><strong>关注GC日志</strong>：分析GC频率、停顿时间、回收量</li><li><strong>避免过度优化</strong>：80%的性能问题由20%的代码引起</li></ol><h3 id="8-2-生产环境配置模板"><a href="#8-2-生产环境配置模板" class="headerlink" title="8.2 生产环境配置模板"></a>8.2 生产环境配置模板</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 通用配置模板</span>
<span class="token parameter variable">-Xms4g</span> <span class="token parameter variable">-Xmx4g</span>  <span class="token comment"># 堆内存固定，避免动态扩容</span>
<span class="token parameter variable">-XX:+UseG1GC</span>   <span class="token comment"># 使用G1收集器</span>
<span class="token parameter variable">-XX:MaxGCPauseMillis</span><span class="token operator">=</span><span class="token number">200</span>  <span class="token comment"># 最大停顿时间200ms</span>
<span class="token parameter variable">-XX:+PrintGCDetails</span> <span class="token parameter variable">-XX:+PrintGCTimeStamps</span>  <span class="token comment"># GC日志</span>
-Xloggc:/var/log/app/gc.log  <span class="token comment"># GC日志文件</span>
<span class="token parameter variable">-XX:+HeapDumpOnOutOfMemoryError</span>  <span class="token comment"># OOM时生成堆转储</span>
<span class="token parameter variable">-XX:HeapDumpPath</span><span class="token operator">=</span>/var/log/app/heap.hprof  <span class="token comment"># 堆转储路径</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="8-3-学习建议"><a href="#8-3-学习建议" class="headerlink" title="8.3 学习建议"></a>8.3 学习建议</h3><ol><li><strong>理论结合实践</strong>：通过实际调优案例加深理解</li><li><strong>阅读源码</strong>：OpenJDK源码是最好的学习资料</li><li><strong>关注社区</strong>：跟进JVM最新发展（ZGC、Shenandoah）</li><li><strong>工具熟练</strong>：掌握各种JVM监控和调优工具</li></ol><p>通过系统学习JVM原理，你将能够：</p><ul><li>快速定位和解决生产环境问题</li><li>编写高性能的Java应用</li><li>在技术面试中脱颖而出</li><li>为架构设计提供坚实基础</li></ul><hr><h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol><li>《深入理解Java虚拟机：JVM高级特性与最佳实践》</li><li>《Java性能优化权威指南》</li><li>OpenJDK官方文档</li><li>Oracle JVM调优指南</li><li>《Java并发编程实战》</li></ol><blockquote><p>本文档将持续更新，欢迎交流讨论！</p></blockquote></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://canjisam.github.io">CanJisam</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://canjisam.github.io/2025/08/18/JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/">https://canjisam.github.io/2025/08/18/JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://canjisam.github.io" target="_blank">诒森的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/JVM/">JVM</a><a class="post-meta__tags" href="/tags/%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/">内存模型</a><a class="post-meta__tags" href="/tags/%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6/">垃圾回收</a><a class="post-meta__tags" href="/tags/%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/">类加载机制</a><a class="post-meta__tags" href="/tags/%E8%B0%83%E4%BC%98/">调优</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/eca45645431b46fea6db1634a45287b2_2.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/08/15/JWT%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" title="JWT技术详解：原理、应用与最佳实践"><img class="cover" src="/img/cover/eca45645431b46fea6db1634a45287b2_0.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">JWT技术详解：原理、应用与最佳实践</div></div><div class="info-2"><div class="info-item-1">JWT技术详解：原理、应用与最佳实践1. JWT简介JWT（JSON Web Token）是一种开放标准（RFC 7519），它定义了一种紧凑且自包含的方式，用于在各方之间安全地传输信息作为JSON对象。由于数字签名的存在，这些信息是可验证和可信的。JWT可以使用密钥（使用HMAC算法）或使用RSA或ECDSA的公钥&#x2F;私钥对进行签名。 1.1 JWT的特点 紧凑性：JWT可以通过URL、POST参数或HTTP Header发送，体积小，传输速度快。 自包含：包含了所有用户所需要的信息，避免了多次查询数据库。 易于传输：跨语言支持，支持所有主流编程语言。 安全性：使用数字签名确保信息不被篡改。 无状态：服务端无需存储会话信息，降低了服务器的负载。 1.2 JWT与传统Session的比较 特性 JWT Session 存储位置 客户端 服务端 可扩展性 高（无状态） 低（需要会话存储） 跨域支持 原生支持 需要额外配置 安全性 取决于如何使用 相对安全 性能 减少数据库查询 需要查询会话信息 过期控制 需要额外处理 内置支持 2....</div></div></div></a><a class="pagination-related" href="/2025/08/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E7%AC%94%E8%AF%95%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AF%A6%E8%A7%A3/" title="数据结构与算法笔试核心知识点详解"><img class="cover" src="/img/cover/9f13ef7ffc274ea1974a8c4bd3849b26_3.png" onerror='onerror=null,src="/img/404.jpg"' alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">数据结构与算法笔试核心知识点详解</div></div><div class="info-2"><div class="info-item-1">数据结构与算法笔试核心知识点详解前言数据结构与算法是计算机科学的核心基础，也是技术笔试面试中的必考内容。本文将系统梳理链表、树、图、哈希表、排序算法等核心知识点，结合典型面试题型进行深入解析，帮助读者全面掌握笔试必备技能。 第一章：链表（Linked List）1.1 链表基础概念链表是一种线性数据结构，由一系列节点组成，每个节点包含数据域和指针域。相比数组，链表具有动态扩容、插入删除高效的优势。 1.1.1 链表分类单链表（Singly Linked List） 每个节点只有一个指向下一节点的指针 只能单向遍历 结构简单，内存占用少 双链表（Doubly Linked List） 每个节点有两个指针：prev和next 支持双向遍历 插入删除操作更灵活 循环链表（Circular Linked List） 尾节点指针指向头节点 可以循环遍历 常用于实现队列等数据结构 1.2 链表核心操作1.2.1 单链表节点定义class ListNode &#123; int val; ListNode next; ListNode(int...</div></div></div></a></nav><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/cover/avator.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info-name">CanJisam</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">55</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">93</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">27</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/canjisam"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/canjisam" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a><a class="social-icon" href="mailto:canjisam@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color:#4a7dbe"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎关注微信公众号：昨宵梦寐与君语（国内访问更稳定）</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98"><span class="toc-number">1.</span> <span class="toc-text">JVM原理深度解析与调优实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="toc-number">1.1.</span> <span class="toc-text">1. JVM内存模型深度解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E5%88%92%E5%88%86"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 内存区域划分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E5%90%84%E5%8C%BA%E5%9F%9F%E8%AF%A6%E8%A7%A3%E4%B8%8EOOM%E5%88%86%E6%9E%90"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 各区域详解与OOM分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E5%A0%86%EF%BC%88Heap%EF%BC%89"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">1.2.1 堆（Heap）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E6%96%B9%E6%B3%95%E5%8C%BA%EF%BC%88Method-Area%EF%BC%89"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">1.2.2 方法区（Method Area）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E8%99%9A%E6%8B%9F%E6%9C%BA%E6%A0%88%EF%BC%88JVM-Stack%EF%BC%89"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">1.2.3 虚拟机栈（JVM Stack）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-%E5%AF%B9%E8%B1%A1%E5%88%86%E9%85%8D%E4%B8%8E%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 对象分配与内存布局</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-1-%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E8%BF%87%E7%A8%8B"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">1.3.1 对象创建过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-2-%E5%AF%B9%E8%B1%A1%E5%86%85%E5%AD%98%E5%B8%83%E5%B1%80"><span class="toc-number">1.1.3.2.</span> <span class="toc-text">1.3.2 对象内存布局</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E5%89%96%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">2. 垃圾回收机制深度剖析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 垃圾回收基础理论</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E5%88%A4%E6%96%AD%E5%AF%B9%E8%B1%A1%E5%AD%98%E6%B4%BB%E7%AE%97%E6%B3%95"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">2.1.1 判断对象存活算法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%AE%97%E6%B3%95"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2.1.2 垃圾回收算法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-HotSpot%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 HotSpot垃圾回收器详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E6%A6%82%E8%A7%88"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">2.2.1 垃圾回收器概览</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-CMS%E6%94%B6%E9%9B%86%E5%99%A8%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">2.2.2 CMS收集器详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-G1%E6%94%B6%E9%9B%86%E5%99%A8%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">2.2.3 G1收集器详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E5%99%A8%E5%AF%B9%E6%AF%94"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">2.2.4 垃圾回收器对比</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Full-GC%E8%A7%A6%E5%8F%91%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 Full GC触发条件</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">3. 类加载机制深度解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 类加载过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-1-%E5%8A%A0%E8%BD%BD%E9%98%B6%E6%AE%B5"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">3.1.1 加载阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-2-%E9%AA%8C%E8%AF%81%E9%98%B6%E6%AE%B5"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">3.1.2 验证阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-3-%E5%87%86%E5%A4%87%E9%98%B6%E6%AE%B5"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">3.1.3 准备阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-4-%E8%A7%A3%E6%9E%90%E9%98%B6%E6%AE%B5"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">3.1.4 解析阶段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-5-%E5%88%9D%E5%A7%8B%E5%8C%96%E9%98%B6%E6%AE%B5"><span class="toc-number">1.3.1.5.</span> <span class="toc-text">3.1.5 初始化阶段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 双亲委派模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">3.2.1 双亲委派模型实现</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E7%A0%B4%E5%9D%8F%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">3.2.2 破坏双亲委派模型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 类加载优化策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-1-%E9%A2%84%E5%8A%A0%E8%BD%BD%E7%AD%96%E7%95%A5"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">3.3.1 预加载策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-2-%E6%87%92%E5%8A%A0%E8%BD%BD%E7%AD%96%E7%95%A5"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">3.3.2 懒加载策略</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-3-%E7%83%AD%E9%83%A8%E7%BD%B2%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.3.3.3.</span> <span class="toc-text">3.3.3 热部署实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5"><span class="toc-number">1.4.</span> <span class="toc-text">4. 对象创建与内存分配策略</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E5%AF%B9%E8%B1%A1%E5%88%9B%E5%BB%BA%E8%AF%A6%E7%BB%86%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 对象创建详细过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-1-%E6%A3%80%E6%9F%A5%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">4.1.1 检查加载</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-2-%E5%88%86%E9%85%8D%E5%86%85%E5%AD%98"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">4.1.2 分配内存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-1-3-%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E5%AE%9E%E6%88%98"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">4.1.3 内存分配实战</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%86%85%E5%AD%98%E5%88%86%E9%85%8D%E7%AD%96%E7%95%A5"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 内存分配策略</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-1-%E5%AF%B9%E8%B1%A1%E4%BC%98%E5%85%88%E5%9C%A8Eden%E5%88%86%E9%85%8D"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">4.2.1 对象优先在Eden分配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-2-%E5%A4%A7%E5%AF%B9%E8%B1%A1%E7%9B%B4%E6%8E%A5%E8%BF%9B%E5%85%A5%E8%80%81%E5%B9%B4%E4%BB%A3"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">4.2.2 大对象直接进入老年代</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-2-3-%E9%95%BF%E6%9C%9F%E5%AD%98%E6%B4%BB%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E5%85%A5%E8%80%81%E5%B9%B4%E4%BB%A3"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">4.2.3 长期存活的对象进入老年代</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-JVM%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E6%94%AF%E6%8C%81%E6%9C%BA%E5%88%B6"><span class="toc-number">1.5.</span> <span class="toc-text">5. JVM并发编程支持机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-synchronized%E9%94%81%E5%8D%87%E7%BA%A7%E8%BF%87%E7%A8%8B"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 synchronized锁升级过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-%E9%94%81%E7%8A%B6%E6%80%81%E6%BC%94%E5%8C%96"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">5.1.1 锁状态演化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-%E9%94%81%E5%8D%87%E7%BA%A7%E5%AE%9E%E6%88%98"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">5.1.2 锁升级实战</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-volatile%E5%85%B3%E9%94%AE%E5%AD%97%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 volatile关键字原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-1-%E5%86%85%E5%AD%98%E8%AF%AD%E4%B9%89"><span class="toc-number">1.5.2.1.</span> <span class="toc-text">5.2.1 内存语义</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-2-volatile%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.2.2.</span> <span class="toc-text">5.2.2 volatile实现原理</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-Monitor%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 Monitor原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-1-Monitor%E7%BB%93%E6%9E%84"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">5.3.1 Monitor结构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-2-Monitor%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">5.3.2 Monitor实现</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-JVM%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98"><span class="toc-number">1.6.</span> <span class="toc-text">6. JVM调优实战</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E8%B0%83%E4%BC%98%E5%B7%A5%E5%85%B7"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 调优工具</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-1-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%B7%A5%E5%85%B7"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">6.1.1 命令行工具</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-2-%E5%8F%AF%E8%A7%86%E5%8C%96%E5%B7%A5%E5%85%B7"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">6.1.2 可视化工具</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E8%B0%83%E4%BC%98%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 调优案例分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-1-%E9%AB%98%E5%B9%B6%E5%8F%91%E5%9C%BA%E6%99%AF%E8%B0%83%E4%BC%98"><span class="toc-number">1.6.2.1.</span> <span class="toc-text">6.2.1 高并发场景调优</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-2-%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E6%8E%92%E6%9F%A5"><span class="toc-number">1.6.2.2.</span> <span class="toc-text">6.2.2 内存泄漏排查</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98%E5%8F%82%E6%95%B0%E6%80%BB%E7%BB%93"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 性能调优参数总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-1-%E5%A0%86%E5%86%85%E5%AD%98%E5%8F%82%E6%95%B0"><span class="toc-number">1.6.3.1.</span> <span class="toc-text">6.3.1 堆内存参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-2-GC%E5%8F%82%E6%95%B0"><span class="toc-number">1.6.3.2.</span> <span class="toc-text">6.3.2 GC参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-3-%E7%9B%91%E6%8E%A7%E5%8F%82%E6%95%B0"><span class="toc-number">1.6.3.3.</span> <span class="toc-text">6.3.3 监控参数</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E9%AB%98%E9%A2%91%E9%9D%A2%E8%AF%95%E9%A2%98%E6%80%BB%E7%BB%93"><span class="toc-number">1.7.</span> <span class="toc-text">7. 高频面试题总结</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-JVM%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 JVM内存模型相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 垃圾回收相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.3.</span> <span class="toc-text">7.3 类加载机制相关</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E7%9B%B8%E5%85%B3"><span class="toc-number">1.7.4.</span> <span class="toc-text">7.4 并发编程相关</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E6%80%BB%E7%BB%93%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.8.</span> <span class="toc-text">8. 总结与最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-JVM%E8%B0%83%E4%BC%98%E9%BB%84%E9%87%91%E6%B3%95%E5%88%99"><span class="toc-number">1.8.1.</span> <span class="toc-text">8.1 JVM调优黄金法则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.8.2.</span> <span class="toc-text">8.2 生产环境配置模板</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.8.3.</span> <span class="toc-text">8.3 学习建议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.9.</span> <span class="toc-text">参考资料</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/18/Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AF%A6%E8%A7%A3/" title="Linux系统管理核心知识点详解"><img src="/img/cover/eca45645431b46fea6db1634a45287b2_0.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="Linux系统管理核心知识点详解"></a><div class="content"><a class="title" href="/2025/08/18/Linux%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AF%A6%E8%A7%A3/" title="Linux系统管理核心知识点详解">Linux系统管理核心知识点详解</a><time datetime="2025-08-18T15:46:10.000Z" title="发表于 2025-08-18 23:46:10">2025-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/18/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AF%A6%E8%A7%A3/" title="计算机网络核心知识点详解"><img src="/img/cover/eca45645431b46fea6db1634a45287b2_3.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="计算机网络核心知识点详解"></a><div class="content"><a class="title" href="/2025/08/18/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AF%A6%E8%A7%A3/" title="计算机网络核心知识点详解">计算机网络核心知识点详解</a><time datetime="2025-08-18T15:33:50.000Z" title="发表于 2025-08-18 23:33:50">2025-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E7%AC%94%E8%AF%95%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AF%A6%E8%A7%A3/" title="数据结构与算法笔试核心知识点详解"><img src="/img/cover/9f13ef7ffc274ea1974a8c4bd3849b26_3.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="数据结构与算法笔试核心知识点详解"></a><div class="content"><a class="title" href="/2025/08/18/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95%E7%AC%94%E8%AF%95%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E7%82%B9%E8%AF%A6%E8%A7%A3/" title="数据结构与算法笔试核心知识点详解">数据结构与算法笔试核心知识点详解</a><time datetime="2025-08-18T14:54:27.000Z" title="发表于 2025-08-18 22:54:27">2025-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/18/JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/" title="JVM原理深度解析与调优实战"><img src="/img/cover/eca45645431b46fea6db1634a45287b2_2.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="JVM原理深度解析与调优实战"></a><div class="content"><a class="title" href="/2025/08/18/JVM%E5%8E%9F%E7%90%86%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%E4%B8%8E%E8%B0%83%E4%BC%98%E5%AE%9E%E6%88%98/" title="JVM原理深度解析与调优实战">JVM原理深度解析与调优实战</a><time datetime="2025-08-18T14:54:20.000Z" title="发表于 2025-08-18 22:54:20">2025-08-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/15/JWT%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" title="JWT技术详解：原理、应用与最佳实践"><img src="/img/cover/eca45645431b46fea6db1634a45287b2_0.png" onerror='this.onerror=null,this.src="/img/404.jpg"' alt="JWT技术详解：原理、应用与最佳实践"></a><div class="content"><a class="title" href="/2025/08/15/JWT%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3/" title="JWT技术详解：原理、应用与最佳实践">JWT技术详解：原理、应用与最佳实践</a><time datetime="2025-08-15T14:13:47.000Z" title="发表于 2025-08-15 22:13:47">2025-08-15</time></div></div></div></div></div></div></main><footer id="footer" style="background-image:url(/img/cover/footer-bg.jpg)"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By CanJisam</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.3.5/source/js/utils.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.3.5/source/js/main.min.js"></script><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.3.5/source/js/tw_cn.min.js"></script><div class="js-pjax"><script>(()=>{const t="shuoshuo"===GLOBAL_CONFIG_SITE.pageType,n={distractionFreeMode:!0},e=t=>{const n=document.querySelector("#post-meta .gitalk-comment-count");n&&(n.textContent=t)},i=(i,a)=>{t&&(window.shuoshuoComment.destroyGitalk=()=>{i.children.length&&(i.innerHTML="",i.classList.add("no-comment"))});new Gitalk({clientID:"Ov23lifFntnoMvOg1Fir",clientSecret:"0596c9896ad9c699f2188c823bce11b2d3d231e6",repo:"canjisam.github.io",owner:"canjisam",admin:["canjisam"],updateCountCallback:e,...n,id:t?a:n&&n.id||"1146a6000eaa8462ec1d593adcb381a4"}).render("gitalk-container")},a=async(t,n)=>{"function"==typeof Gitalk||(await btf.getCSS("https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.css"),await btf.getScript("https://cdn.jsdelivr.net/npm/gitalk@1.8.0/dist/gitalk.min.js")),i(t,n)};t?window.shuoshuoComment={loadComment:a}:a()})()</script></div><script>window.XF_API_KEY="33ec326f4348794e214e464ff2990f32",window.XF_API_SECRET="NDQ3NGYyZWMwZWQ0ZWQ4ZWUzMTMwY2Y4"</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章..." type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/hexo-theme-butterfly@5.3.5/source/js/search/local-search.min.js"></script></div></div></body></html>